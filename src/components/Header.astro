---
// Header.astro - Componente de navegación principal
import AuthActions from './AuthActions.jsx';
import AuthActionsMobile from './AuthActionsMobile.jsx';
import { getNavigationData } from '../lib/directus.js';
import { Image } from "astro:assets";
// Obtener datos de navegación
const { data: navigationData, error } = await getNavigationData();
const mainNavigation = navigationData?.find(nav => nav.id === 'main')?.items || [];
---

<script>
  // Script para manejar el menú móvil
  let menuOpen = false;
  
  function toggleMenu() {
    menuOpen = !menuOpen;
    updateMenuVisibility();
  }

  function closeMenu() {
    menuOpen = false;
    updateMenuVisibility();
  }

  function updateMenuVisibility() {
    const mobileMenu = document.getElementById('mobile-menu');
    const overlay = document.getElementById('mobile-overlay');
    
    if (mobileMenu && overlay) {
      if (menuOpen) {
        // Mostrar overlay primero con fade in
        overlay.classList.remove('hidden');
        overlay.classList.remove('opacity-0');
        overlay.classList.add('opacity-100');
        
        // Mostrar menú con slide in desde la derecha
        mobileMenu.classList.remove('hidden');
        mobileMenu.classList.remove('translate-x-full');
        mobileMenu.classList.add('translate-x-0');
        
        // Agregar sombra y escala sutil
        mobileMenu.classList.add('shadow-2xl');
        mobileMenu.classList.remove('scale-95');
        mobileMenu.classList.add('scale-100');
      } else {
        // Ocultar menú con slide out hacia la derecha
        mobileMenu.classList.remove('translate-x-0');
        mobileMenu.classList.add('translate-x-full');
        mobileMenu.classList.remove('shadow-2xl');
        mobileMenu.classList.remove('scale-100');
        mobileMenu.classList.add('scale-95');
        
        // Ocultar overlay con fade out
        overlay.classList.remove('opacity-100');
        overlay.classList.add('opacity-0');
        
        // Ocultar elementos después de la animación
        setTimeout(() => {
          mobileMenu.classList.add('hidden');
          overlay.classList.add('hidden');
        }, 300);
      }
    }
  }

  function handleNavClick() {
    closeMenu();
  }

  // Escuchar el evento para cerrar el menú móvil desde React
  window.addEventListener('closeMobileMenu', closeMenu);

  // Configurar event listeners cuando el DOM esté listo
  document.addEventListener('DOMContentLoaded', function() {
    // Botón hamburguesa
    const hamburgerButton = document.getElementById('hamburger-button');
    if (hamburgerButton) {
      hamburgerButton.addEventListener('click', toggleMenu);
    }

    // Botón de cerrar
    const closeButton = document.getElementById('close-menu-button');
    if (closeButton) {
      closeButton.addEventListener('click', closeMenu);
    }

    // Overlay
    const overlay = document.getElementById('mobile-overlay');
    if (overlay) {
      overlay.addEventListener('click', closeMenu);
    }

    // Enlaces de navegación móvil
    const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');
    mobileNavLinks.forEach(link => {
      link.addEventListener('click', handleNavClick);
    });
  });
</script>

<header class="text-neutral-darkest relative">
  <!-- Top bar -->
  <div class="flex items-center justify-between px-4 py-4 md:py-6 md:px-12">
    <!-- Espacio vacío para balancear el layout en móvil -->
    <div class="w-8 md:hidden"></div>
    
    <!-- Mensaje de valor (desktop) -->
    <div class="hidden md:block md:w-1/3">
    </div>
    
    <!-- Logo centrado -->
    <div class="flex-1 flex flex-col justify-center items-center">
      <a href="/">
        <img src="/logo_x2.png" alt="Travel with Gastón" class="w-50 md:w-auto md:h-5 lg:h-8">
      </a>
      <div class="mt-2 hidden md:block text-center text-xs font-normal text-neutral-dark italic font-heading">Crafting Journeys Beyond Expectations</div>
    </div>
    
    <!-- Acciones de usuario (login/signup) solo desktop -->
    <div class="hidden md:flex md:w-1/3 justify-end items-center gap-4">
      <AuthActions client:load />
    </div>
    
    <!-- Menú hamburguesa (solo móvil) -->
    <button id="hamburger-button" class="md:hidden w-8 h-8 flex items-center justify-center z-20 transition-transform duration-200 hover:scale-110 active:scale-95" aria-label="Open menu">
      <div class="space-y-1">
        <span class="block w-6 h-0.5 bg-neutral-lighter transition-all duration-200"></span>
        <span class="block w-6 h-0.5 bg-neutral-lighter transition-all duration-200"></span>
        <span class="block w-6 h-0.5 bg-neutral-lighter transition-all duration-200"></span>
      </div>
    </button>
  </div>
  <!-- Línea divisoria -->
  <div class="border-t border-neutral-lighter/50"></div>
  <!-- Navegación (solo desktop) -->
  <nav class="hidden md:flex justify-center gap-10 py-4">
    <a href="/" class="text-xl text-neutral hover:text-primary transition-colors">Home</a>
    <a href="/search" class="text-xl text-neutral hover:text-primary transition-colors">Find a Hotel</a>
    {mainNavigation.map((item: any) => (
      <a 
        href={item.page.permalink}
        class="text-xl text-neutral hover:text-primary transition-colors"
      >
        {item.title}
      </a>
    ))}
  </nav>
  
  <!-- Menú móvil desplegable -->
  <div id="mobile-overlay" class="fixed inset-0 bg-black/40 z-10 hidden opacity-0 transition-all duration-300 ease-out"></div>
  <nav
    id="mobile-menu"
    class="fixed top-0 right-0 w-64 h-full bg-white shadow-lg flex flex-col gap-6 p-8 z-30 hidden transform transition-all duration-300 ease-out translate-x-full scale-95"
  >
    <!-- Botón de cerrar -->
    <button 
      id="close-menu-button"
      class="absolute top-4 right-4 text-neutral-lighter hover:text-neutral-darkest transition-all duration-200 hover:scale-110 active:scale-95"
      aria-label="Close menu"
    >
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>
    
    <!-- Navegación móvil -->
    <div class="mt-12 space-y-4">
      <a href="/" class="mobile-nav-link block text-lg text-neutral hover:text-primary transition-all duration-200 hover:translate-x-2 py-2 px-3 rounded-lg hover:bg-neutral-50">Home</a>
      <a href="/search" class="mobile-nav-link block text-lg text-neutral hover:text-primary transition-all duration-200 hover:translate-x-2 py-2 px-3 rounded-lg hover:bg-neutral-50">Search</a>
      {mainNavigation.map((item) => (
        <a href={item.page.permalink}
          class="mobile-nav-link block text-lg text-neutral hover:text-primary transition-all duration-200 hover:translate-x-2 py-2 px-3 rounded-lg hover:bg-neutral-50">
          {item.title}
        </a>
      ))}
    </div>

    <AuthActionsMobile client:load />
  </nav>
</header> 