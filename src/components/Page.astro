---
import { getPageData } from '../lib/directus'
import HeroSection from './HeroSection.astro'
import InspirationGrid from './InspirationGrid.astro'
import FeaturedHotels from './FeaturedHotels.astro'
import JoinNow from './JoinNow.astro'
import Footer from './Footer.astro'

if (Astro.request.method === "POST") {
  // Handle form submission logic
}

// get current slug
const slug = Astro.url.pathname;
const payload = await getPageData(slug);

// Verificar si hay datos y bloques
const blocks = payload?.data?.blocks || [];

// Debug: mostrar los datos que estamos recibiendo
console.log('Payload completo:', JSON.stringify(payload, null, 2));
console.log('Bloques encontrados:', blocks.length);
blocks.forEach((block, index) => {
  console.log(`Bloque ${index}:`, {
    collection: block.collection,
    item: block.item,
    hasImage: !!block.item?.image
  });
});
---

<div class="page-content">
  {blocks.map((block, index) => {
    // Renderizar HeroSection si el bloque es de tipo block_hero
    if (block.collection === 'block_hero') {
      return <HeroSection data={block.item} />;
    }
    
    // Renderizar InspirationGrid si el bloque es de tipo block_inspiration_grid
    if (block.collection === 'block_inspiration_grid') {
      return <InspirationGrid data={block.item} />;
    }
    
    // Renderizar FeaturedHotels si el bloque es de tipo block_featured_hotels
    if (block.collection === 'block_featured_hotels') {
      return <FeaturedHotels data={block.item} />;
    }
    
    // Para otros tipos de bloques, puedes agregar más condiciones aquí
    // Por ejemplo: if (block.collection === 'block_content') { ... }
    
    // Fallback para bloques no reconocidos
    return (
      <div class="unknown-block p-4 bg-gray-800 text-black">
        <p>Bloque no reconocido: {block.collection}</p>
        <pre class="text-xs mt-2">{JSON.stringify(block, null, 2)}</pre>
      </div>
    );
  })}
  <JoinNow />
  <Footer />
</div>

<style>
  .page-content {
    width: 100%;
  }
  
  .unknown-block {
    padding: 2rem;
    background: #f5f5f5;
    border: 1px solid #ddd;
    margin: 1rem 0;
  }
</style>
